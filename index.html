<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Controller Main view</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#273c42">
        <meta name="msapplication-TileColor" content="#273c42">

        <link rel="apple-touch-icon" href="/pics/icon.png">

        <link href="css/bulmaswatch.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
        <script type="application/javascript" src="js/vendor/jquery-3.2.1.min.js"></script>
        <script src="js/request.js" type="text/javascript"></script>
        <script src="js/main.js" type="text/javascript"></script>
        <style>
            .hero .container {
                width: 95%;
                bottom:0;
            }
            dca {
                width: 40px;
                height: 68px;
                background-color: red;
                animation-name: dockerContainerAnim;
                animation-duration: 2s;
                animation-iteration-count: infinite;
                border: solid #0e506f 1.5px;
                /*animation-play-state: running;*/
            }
            dcna {
                width: 40px;
                height: 68px;
                background-color: red;
                animation-name: dockerContainerAnimDown;
                animation-duration: 2s;
                /*animation-iteration-count: 0;*/
                border: solid #0e506f 1.5px;
                animation-play-state: paused;
            }
            @keyframes dockerContainerAnim {
                from {background-color: #2cb9d9;}
                to {background-color: #3d8b40;}
            }
            @keyframes dockerContainerAnimDown {
                from {background-color: #2cb9d9;}
                to {background-color: #b91e13;}
            }
        </style>
    </head>

    <body class="theme-page" style="background-color:#2cb9d9; min-height: 1080px">
    <section class="hero is-primary">
            <div class="hero-head">
                <img src="img/accesa_logo_bg.png" style="height: 68px; width: auto;float:right;">
                <nav class="main-nav navbar" id="main-nav-barID">
                    <div>
                        <div class="column">
                            <div class="navbar-start">
                                <a class="navbar-item" href="#" onclick="reload()">
                                    <h1 class="title is-5">Controller</h1>
                                </a>
                                <input class="input is-rounded" type="text" placeholder="Users Rate" id="usersRateID" value="" style="width:125px">
                                <input class="input is-rounded" type="text" placeholder="Total Users" id="totalUsersID" style="width:125px">
                                <input class="input is-rounded" type="text" placeholder="Test Name" id="testNameID" style="width:250px">
                            </div>
                            <span class="navbar-toggle">
                            </span>
                        </div>
                    </div>
                        <div class="navbar-menu" id="navBarMenuID" style="visibility: visible; ">
                            <div class="navbar-start">
                                <a class="navbar-item " id="navBarItem">
                                </a>
                                <div class="navbar-item has-dropdown is-hoverable" id="navBarParentID" disabled="true">
                                    <a class="navbar-link  is-active" onclick="getAllSessions()" id="selectSessionNavLink">Sessions</a>
                                    <div class="navbar-dropdown" id="selectSessionNavBarID" style="background-color:transparent"></div>
                                </div>
                            </div>
                        </div>
                    <table class="table is-bordered" id="memoryTableID" style="height: 68px; width: auto;float:right; alignment: right; background-color: Transparent; margin-bottom: 0; padding: 0.5em; line-height: 0.75;">
                        <thead>
                        <script>getStats()</script>
                        <tr>
                            <th> Total Memory </th>
                            <th> Free Memory </th>
                            <th> Used Memory </th>
                            <th> CPU usage </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td id="tMemID">  </td>
                            <td id="fMemID">  </td>
                            <td id="uMemID">  </td>
                            <td id="cpuUsageID">  </td>
                        </tr>
                        </tbody>
                    </table>
                    <!--<a class="button is-large" id="buttonisDockerView" style="background: #00a3e1"></a>-->
                    <div id="dcaDivID">
                        <dca class="dca" id="buttonisDockerView">WebServer</dca>
                        <dca class="dca" id="buttonisDockerView">Influx-DB</dca>
                        <p>
                    </div>
                    <div class="column" id="TitleBar">
                        <a>
                            <p class="loader" id="testRunningSpinnerID" style="visibility: hidden; float: right;">_.-</p>
                            <p class="subtitle is-5 has-text-weight-semibold " id="timerID" style="float: right; width: 125px"> 0h 0m 0s </p>
                        </a>
                    </div>
                </nav>
                <div class="tabs is-small">
                    <hr>
                    <ul>
                        <li>
                            <a href="javascript:void(0)" onclick="showTab(event, 'mainControllerID')">Main Controller</a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" onclick="showTab(event, 'settingsControllerID')">Settings</a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" onclick="showTab(event, 'containerControllerID')">Containers</a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" onclick="showTab(event, 'debugControllerID')">Debug</a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" onclick="showTab(event, 'helpControllerID')">Help</a>
                        </li>
                    </ul>
                </div>
                <div id="mainControllerID" class="tabcontent">
                </div>
                <div id="containerControllerID" class="tabcontent">
                    <a class="button is-primary is-inverted"  title="Container UP" onclick="rampUpContianer('start');">Container UP</a>
                    <input class="input is-rounded" type="text" placeholder="Container number" id="containerNoId" value="1" style="width:125px">
                    <a class="button is-danger is-active"  title="Container STOP" onclick="rampUpContianer('stop');">Container STOP</a>            </div>
                <div id="debugControllerID" class="tabcontent">
                    <div class="container">
                        <h5 class="title">  </h5>
                        <pre>
                        <textarea class="textarea" placeholder="Response will be printed here" aria-autocomplete="list" id="responseTextField" onclick="auto_grow(this)"></textarea>
                        <button class="button" aria-haspopup="true" aria-controls="dropdown-menu" onclick="clearResponseFunction()">
                            <span>Clear response</span>
                        </button>
                    </pre>
                    </div>
                </div>
                <div id="settingsControllerID" class="tabcontent">
                    <input class="input is-rounded" type="text" placeholder="Insert GIT repo " id="importGitRepoID" style="width:500px">
                    <div class="column">
                    <button class="button" id="applyGitRepoID" onclick="fetchRepoJMX()">
                        <span>Apply Repo</span>
                    </button>
                    <div class="dropdown">
                        <div class="dropdown-trigger">
                            <button class="button is-info" aria-haspopup="true" aria-controls="dropdown-menu2" onclick="getBranchList()">
                                <span>Branches</span>
                            </button>
                        </div>
                        <div class="dropdown-menu" id="dropdown-menu2" role="menu">
                            <div class="dropdown-content" id="select-Branch">
                            </div>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-trigger">
                            <button class="button" id="editTestConfigID" onclick="disableEnableTestConfigInput(false)">
                                <span>Edit test config</span>
                            </button>
                        </div>
                        <div class="dropdown-menu" id="dropdown-menu" role="menu">
                        </div>
                    </div>
                        <hr>
                        <form id="upload-file" method="post" enctype="multipart/form-data" style="border: transparent; border: 0 hidden">
                            <a id="uploadTitleID"></a>
                            <fieldset style="border: transparent">
                                <style>
                                    .file.is-primary:hover .file-cta{
                                        background-color: #2cb9d9;
                                    }
                                </style>
                                <span class="file-label"></span>
                            </fieldset>
                            <div class="field">
                                <div class="file is-primary">
                                    <label class="file-label">
                                        <input class="file-input" id="inputFileID" type="file" name="file" onchange="uploadFile()">
                                        <span class="file-cta">
                                          <span class="file-icon">
                                            <i class="fa fa-upload"></i>
                                          </span>
                                          <span class="file-label">Upload Project File</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </form>
                        <hr>
                    </div>

                    <a class="navbar-item" href="#" onclick="updateSession()" style="height: 68px; width: auto;float:left;">
                    <h5 class="title is-5" >Update Session</h5>
                    </a>
                    <a class="navbar-item" href="#" onclick="clearAllSessions()" style="height: 68px; width: auto;float:left;">
                        <h5 class="title is-5">Clear All Sessions</h5>
                    </a>
                </div>
                <div id="helpControllerID" class="tabcontent">
                    <div class="title">REST API documentation</div>
                    <hr>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/projects</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for fetching the available projects from the Projects configured repository.<br/>
                        <em>Example: {"projects": ["/root/testPage/Projects/project1.jmx","/root/testPage/Projects/sample-test3.jmx"],"stat": "ok"}</em>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/health</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for verifying the HEALTH of the webServer.<br/>
                        <em>Example: {"stat": "ok"}</em>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/stats</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for fetching the CPU, memory and running processes on the HOST.<br/>
                        <em>Example: {"cpu": 13.3,"memv": {"memFree": 204,"memUsed": 316,"memoryTotal": 1996},"processes": [{"name": "systemd","pid": 1},{"name": "sshd","pid": 32226}],"stat": "ok"}</em>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/deployContainer</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for fetching the CPU, memory and running processes on the HOST.<br/>
                        <strong>SupportedParams: branchName=develop</strong><br />
                        <em>Example: {"cpu": 13.3,"memv": {"memFree": 204,"memUsed": 316,"memoryTotal": 1996},"processes": [{"name": "systemd","pid": 1},{"name": "sshd","pid": 32226}],"stat": "ok"}</em>.
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/branches</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for fetching list of available branches on the configured repository<br/>
                        <em>Example: {"branchList": ["origin/master","origin/accesa","origin/develop"],"stat": "ok"}</em>.
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/getVusers</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for fetching max number of vUsers expected for the current Test.<br/>
                        <em>Example: {"reason": "users or rate file is not initialized.","stat": "failed"}</em>.<br/>
                        <strong>TO BE DELETED</strong>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/updateVusers</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for updating the maximum users for the current test.<br/>
                        <em>Example: {"rampup": "0","rate": "1","stat": "ok","totalUsers": "1"}</em>.<br/>
                        <strong>TO BE DELETED</strong>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/updateSession</h3>
                        <h4>Type: POST</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for Setting the current controller session - needs to be provided all the current information that is displayed on the page.<br/>
                        <strong>Content-Type: application/x-www-form-urlencoded</strong><br/>

                        <em>sessionID: bc066098-5d5f-2ba8-fdb5-623cd0a86532
                            _id: bc066098-5d5f-2ba8-fdb5-623cd0a86532
                            usersRateInput: 10
                            totalUsers: 15000
                            testNameID: baseline+and+checkout
                            startTimerDateObj: 1529132880966
                            projectID: hardCodedProject.jmx
                            testStatus: 1</em>.<br/>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/getSession</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for fetching the session information about current running test.<br/>
                        <em>Example: [{"_id": "bc066098-5d5f-2ba8-fdb5-623cd0a86532","projectID": "hardCodedProject.jmx","sessionID": "bc066098-5d5f-2ba8-fdb5-623cd0a86532","startTimerDateObj": "1529132880966","testNameID": "baseline and checkout","testStatus": "1","totalUsers": 15000","usersRateInput": "10"}]</em>.<br/>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/containerUp</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for Ramp-up an additional docker container.<br/>
                        <strong>Supporting Params: containerName=containerName/Description</strong><br/>
                        <em>Example: {  "stat": "ok",   "statusCode": 0}</em>.<br/>
                        Future development: Will support container type
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/containerDown</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for killing a docker container by name.<br/>
                        <strong>Supporting Params: containerName=containerName/Description</strong><br/>
                        <em>Example: {  "stat": "ok",   "statusCode": 0}</em>.<br/>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/forceContainersDown</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for killing all running docker containers.<br/>
                        <em>Example: {  "stat": "ok",   "statusCode": 0}</em>.<br/>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/clearSessions</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for clearing all stored sessions.<br/>
                        <em>Example: {"result": {"n": 2,"ok": 1},"stat": "ok"}</em>.<br/>
                        <em>"n":2 - stands for how many sessions were deleted.</em>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/clearSessionByID</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for clearing a single stored session by its ID.<br/>
                        <strong>Supporting Params: sessionID=bc066098-5d5f-2ba8-fdb5-623cd0a86532</strong><br/>
                        <em>Example: {"result": {"n": 1,"ok": 1},"stat": "ok"}</em>.<br/>
                        <em>"n":1 - 1 is mandatory - impossible to clear more than one single ID at a time.</em>
                    </div>
                    <div class="message-header" style="background: #0e506f">
                        <h3>/evaluateRampup</h3>
                        <h4>Type: GET</h4>
                    </div>
                    <div class="message-body">
                        <strong>Description: </strong>This API is responsible for handling the rampup of the running Jmeter session.<br/>
                        <strong>Supporting Params: activeThreads=100</strong><br/>
                        <em>Example: {"errorCode": "0","message": "All good, no rampup needed","operationResult": "N/A","sessionID": "null","stat": "ok"}</em>.<br/>
                        <em><strong>Details:</strong><br/>If current activeThreads reach 200 then a new container will be deployed.</em><br/>
                        <em>Response: {"errorCode": 200,"message": "Rampup Container ok... ramping up 200 users","operationResult": "{'insertResult': < pymongo.results.UpdateResult object at x7f327638a440>, 'testStatus': 'n/a', 'sessionID': u'81942362-0479-e29f-33ca-c77b7a06a2bf', 'sessionSync': pymongo.results.UpdateResult object at 0x7f327638ad40>}","sessionID": "81942362-0479-e29f-33ca-c77b7a06a2bf","stat": "ok"}</em>
                    </div>
                </div>
            </div>
            <h4 id="selectedProjectID" style="visibility: hidden">Selected project: </h4>
        <div class="hero-body">
                <div class="container" id="testScenarioID" style="visibility: visible; float: left">
                    <h5 class="title">
                        Test Scenario
                    </h5>
                    <p>
                    <div class="dropdown">
                        <div class="dropdown-trigger">
                            <button class="button is-info" aria-haspopup="true" aria-controls="dropdown-menu3" onclick="getProjects()")>
                                <span>Projects</span>
                            </button>
                            <div class="dropdown-menu" id="dropdown-menu3" role="menu">
                                <div class="dropdown-content" id="select-Project">
                                </div>
                            </div>
                        </div>
                    </div>
                        <a class="button is-primary is-inverted"  title="Start the test" onclick="updateStartStopElement(this);" id="startButtonID">START</a>
                    <style>
                    </style>
                        <a class="button is-warning is-active" id="pauseButtonId" title="Pause the current Running scenario", onclick="updatePauseResumeElement(this)" style="visibility: hidden">PAUSE</a>
                    </p>
                </div>
            </div>
        </div>
    </section>
    <script>
        cookieHandler();
        showTab(event, 'mainControllerID');
    </script>
    </body>
</html>
